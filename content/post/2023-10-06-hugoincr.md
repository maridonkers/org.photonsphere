+++
author = "Mari Donkers"
title = "Incrementer for generated Hugo site"
date = "2023-10-06"
description = "The Hugo static site generator produces a site in a public directory but it doesn't do an incremental generate. This Haskell program fixes that by touching all unchanged files (checksum) with the modified date/time from the previous Hugo generate."
featured = false
tags = [
    "Computer",
    "Software",
    "Hugo",
    "Haskell",
]
categories = [
    "linux",
    "haskell",
    "static site generator"
]
series = ["Static Site Generators", "Hugo", "Linux", "Haskell"]
aliases = ["2023-10-06-hugoincr"]
thumbnail = "/images/haskell.svg"
+++

The [Hugo](https://gohugo.io/) static site generator produces a site in a `public` directory but it doesn't do an incremental generate. This [Haskell](https://haskell.org) program works around that by touching all unchanged files (checksum) in the `public` directory with the modified date/time from the previous Hugo generate.
<!--more-->

# Database
A [sqlite](https://www.sqlite.org/index.html) database is maintained. It holds records with these fields:

 - pathName String
 - size Int64
 - md5Checksum String
 - modifiedAt UTCTime

Every time `hugoincr` is run the paths in database (from a previous run) are compared against those in the current Hugo `public` directory.

# Incremental upload
If an incremental upload is done then the modified date/time of files is compared with files on the server to determine whether an upload is necessary or can be skipped.

# Usage

(Linux build available on GitHub)
``` sh
$ ./hugoincr --help
The hugoincr touches files (with a date/time from the previous Hugo build) in
your Hugo public directory, so only files that are actually changed get a
date/time bump when a hugo build is done. Now an ftp upload that checks files'
modified date/time will do an incremental upload.

Usage: hugoincr [--path PATH] [--target PUBLIC] [-r|--reset] [-v|--verbose] 
                [--version]

Available options:
  --path PATH              Subdirectory path where the Hugo public for the
                           increment is located.
  --target PUBLIC          Hugo public subdirectory name for the increment.
  -r,--reset               Reset database.
  -v,--verbose             Enable verbose mode.
  -h,--help                Show this help text
  --version                Show version
```

# GitHub

[maridonkers/hugoincr](https://github.com/maridonkers/hugoincr)
